var dataTable = $('#adminList').DataTable({
    "processing": true,
    "serverSide": true,
    "order": [],
    "responsive": true,
    "ajax": {
        url: adminList,
        type: "POST",
        data: {[csrfName]:csrfHash }
    },
    "columnDefs": [{
        "targets": '_all',
        "orderable": false,
    }],
    "dom": 'lBfrtip',
    "buttons": ['excel','pdf','print'],
    "lengthMenu": [[15, 30, 50, -1], [15, 30, 50, "All"]]
});

$(document).on('click', '.delete', function(e) {
    e.preventDefault();
    var id = $(this).attr("id");
    $.ajax({
            url: setnotauthpass,
            type: 'POST',
            data: {},
            dataType: 'json' 
        })
        .done(function(response) {
            if (response.status == "true") {
                swal({
                    title: 'Please Enter Authentication Password',
                    input: 'password'
                }).then(function(authpass) {
                    $.ajax({
                            url: checkauthpass,
                            type: 'POST',
                            data: 'authpass=' + authpass.value,
                            dataType: 'json'
                        })
                        .done(function(response) {
                            if (response.status == "true") {
                                Swal({
                                    title: 'Are you sure?',
                                    text: "It will be deleted permanently!",
                                    type: 'warning',
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Yes, delete it!'
                                }).then((result) => {
                                    if (result.value) {
                                        $.ajax({
                                                url: deleteCompany,
                                                type: 'POST',
                                                data: 'id=' + id,
                                                dataType: 'json',
                                                beforeSend: function() {
                                                    $('.loadingSet').show();
                                                },
                                                complete: function() {
                                                    $('.loadingSet').hide();
                                                }
                                            })
                                            .done(function(response) {
                                                swal('Deleted!', response.message, response.status);
                                                dataTable.ajax.reload();
                                            })
                                            .fail(function() {
                                                swal('Oops...', 'Something went wrong!', 'error');
                                            });
                                    } else {
                                        swal("Cancelled", "It's safe company data.", "error");
                                    }
                                });

                            } else {
                                swal('Authentication Error!', "Sorry, Your password do not match", 'error');
                                return false;
                            }
                        })
                        .fail(function() {
                            swal('Authentication Error!', "Sorry, Your password do not match", 'error');
                            return false;
                        });
                })
            } else {
                Swal('Authentication Error', 'Sorry, Please set authentication password on your profile.', 'warning');
                return false;
            }
        })
        .fail(function() {
            swal('Oops...', 'Something went wrong!', 'error');
            return;
        });
});

$(document).on('submit', '#addEditCompany', function(event) {
    event.preventDefault();

    $(".alert").html('<span class="alert-icon"><i class="ft-thumbs-down"></i></span><button type="button" class="close" id="alertClose"><span aria-hidden="true">Ã—</span></button>Mandatory field please fill ');
    if ($("#FirstName").val() == '') {
        $(".alert").show();
        $(".alert").append('<strong>"First Name" </strong>');
        return false;
    }
    if ($("#LastName").val() == '') {
        $(".alert").show();
        $(".alert").append('<strong>"Last Name" </strong>');
        return false;
    }
    if ($("#MobileNumber").val() == '') {
        $(".alert").show();
        $(".alert").append('<strong>"Mobile Number" </strong>');
        return false;
    }
    if ($("#EmailAddress").val() == '') {
        $(".alert").show();
        $(".alert").append('<strong>"Email Address" </strong>');
        return false;
    }
    if ($('#operation').val() == 'Add') {
        if ($("#Password").val() == '') {
            $(".alert").show();
            $(".alert").append('<strong>"Password" </strong>');
            return false;
        }
        if ($("#ConfirmPassword").val() == '') {
            $(".alert").show();
            $(".alert").append('<strong>"Confirm Password" </strong>');
            return false;
        }
    }
    if ($("#CompanyName").val() == '') {
        $(".alert").show();
        $(".alert").append('<strong>"Company Name" </strong>');
        return false;
    }
    if ($("#CompanyType").val() == '') {
        $(".alert").show();
        $(".alert").append('<strong>"Company Type" </strong>');
        return false;
    }
    if ($("#CompanyAddress").val() == '') {
        $(".alert").show();
        $(".alert").append('<strong>"Company Address" </strong>');
        return false;
    }
    if ($("#ConfirmPassword").val() != $("#Password").val()) {
        $(".alert").show();
        $(".alert").append('<strong>"Password Not Match" </strong>');
        return false;
    }

    $.ajax({
        url: addcompany,
        type: 'POST',
        data: new FormData(this),
        contentType: false,
        cache: false,
        processData: false,
        dataType: 'json',
        beforeSend: function() {
            $('.loadingSet').show();
        },
        complete: function() {
            $('.loadingSet').hide();
        },
        success: function(response) {
            if (response.status == 'success') {
                $('#operation').val("Add");
                $("#CompanyId").val('');
                $('.addFromTitle').html("Add New Company");
                $('#addFromButton').html('<i class="la la-check-square-o"></i> Add');

                dataTable.ajax.reload();
                $('#addEditCompany')[0].reset();
                swal('Success!', response.message, response.status);
            } else if (response.status == 'error') {
                swal('Warning!', response.message, response.status);
                return false;
            }
        }
    });
});

$(document).on('click', '.update', function(e) {
    var id = $(this).attr("id");
    e.preventDefault();
    $.ajax({
            url: setnotauthpass,
            type: 'POST',
            data: {},
            dataType: 'json'
        })
        .done(function(response) {
            if (response.status == "true") {
                swal({
                    title: 'Please Enter Authentication Password',
                    input: 'password'
                }).then(function(authpass) {
                    $.ajax({
                            url: checkauthpass,
                            type: 'POST',
                            data: 'authpass=' + authpass.value,
                            dataType: 'json'
                        })
                        .done(function(response) {
                            if (response.status == "true") {
                                $.ajax({
                                    url: updateCompany,
                                    method: "POST",
                                    data: { id: id },
                                    dataType: "json",
                                    beforeSend: function() {
                                        $('.loadingSet').show();
                                    },
                                    complete: function() {
                                        $('.loadingSet').hide();
                                    },
                                    success: function(data) {
                                        $('#FirstName').val(data.co_owner_firstname);
                                        $('#LastName').val(data.co_owner_lastname);
                                        $('#MobileNumber').val(data.co_owner_mobile);
                                        $('#EmailAddress').val(data.co_owner_email);
                                        $('#CompanyName').val(data.co_name);
                                        $('#CompanyType').val(data.co_type);
                                        $('#GSTNo').val(data.co_gstno);
                                        $('#CompanyAddress').val(data.co_address);
                                        $('#CompanyWebsite').val(data.co_website);
                                        $('#CompanyId').val(id);
                                        $('#operation').val("Edit");
                                        $('.addFromTitle').html("Edit Company");
                                        $('#addFromButton').html('<i class="la la-edit"></i>Update');
                                    }
                                })

                            } else {
                                swal('Authentication Error!', "Sorry, Your password do not match", 'error');
                                return false;
                            }

                        })
                        .fail(function() {
                            swal('Authentication Error!', "Sorry, Your password do not match", 'error');
                            return false;
                        });
                })

            } else {
                Swal('Authentication Error', 'Sorry, Please set authentication password on your profile.', 'warning');
                return false;
            }
        })
        .fail(function() {
            swal('Oops...', 'Something went wrong!', 'error');
            return;
        });
});

$(document).on('click', '.view', function() {
    var id = $(this).attr("id");
    $.ajax({
        url: viewCompany,
        method: "POST",
        data: { id: id },
        success: function(data) {
            $("#companyView").html(data);
        }
    })
});